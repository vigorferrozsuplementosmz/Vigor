<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title-tag">VIGOR FERROZ | Master Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #fff; color: #222; font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        #admin-area { display: none; background-color: #020617; color: white; min-height: 100vh; position: relative; z-index: 1000; }
        
        .status-pendente { background-color: #facc15 !important; color: #000 !important; }
        .status-confirmado { background-color: #22c55e !important; color: #fff !important; }
        .status-entregue { background-color: #3b82f6 !important; color: #fff !important; }
        .status-cancelado { background-color: #ef4444 !important; color: #fff !important; }

        #social-notify {
            position: fixed; bottom: 20px; left: 20px; background: rgba(0, 0, 0, 0.9); 
            color: white; padding: 12px 20px; border-radius: 15px; font-size: 12px; 
            border-left: 4px solid #39ff14; transition: 0.5s; z-index: 9999;
            transform: translateX(-150%);
        }
        #social-notify.active { transform: translateX(0); }

        .client-input { width: 100%; padding: 15px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 12px; font-size: 16px; }
        .btn-compra { background: #28a745; color: #fff; width: 100%; padding: 20px; border-radius: 12px; font-weight: 900; box-shadow: 0 5px 0 #1e7e34; }
        .tab-active { border-bottom: 3px solid #39ff14; color: #39ff14; }
        .bg-card-admin { background-color: #0f172a; border: 1px solid #1e293b; border-radius: 24px; padding: 24px; }
    </style>
</head>
<body>

    <div id="social-notify">
        <b id="social-name">António</b>
        <div class="text-[10px] opacity-70">Encomendeu às <span id="social-time">--:--</span></div>
    </div>

    <div id="client-site">
        <div class="bg-[#e60000] text-white text-center py-2 text-[11px] font-bold sticky top-0 z-50">
            <span onclick="showAdmin()" style="cursor:pointer">⚠️</span> 
            RESTAM APENAS <span id="urgenciaStock">--</span> UNIDADES
        </div>

        <div class="max-w-[480px] mx-auto p-5">
            <h1 id="site-main-name" class="text-center italic font-black text-3xl text-[#28a745] mb-4 uppercase">VIGOR FERROZ</h1>
            
            <div class="rounded-3xl overflow-hidden mb-6 shadow-lg bg-gray-50">
                <img id="fotoProduto" src="" class="w-full">
            </div>

            <form id="orderForm" autocomplete="off">
                <input type="text" id="nome" placeholder="Nome Completo" class="client-input" required autocomplete="off">
                <input type="tel" id="contacto" placeholder="Telemóvel (Apenas Números)" class="client-input" required autocomplete="off" pattern="[0-9]*" inputmode="numeric">
                
                <select id="provincia" class="client-input" required>
                    <option value="" disabled selected>Província</option>
                    <option>Maputo</option><option>Matola</option><option>Beira</option><option>Nampula</option>
                </select>

                <input type="text" id="bairro" placeholder="Bairro e Localização" class="client-input" required autocomplete="off">
                <select id="horario" class="client-input" required></select>

                <button type="submit" id="btnSubmit" class="btn-compra">
                    <span class="text-2xl" id="precoExibicao">--- MT</span>
                </button>
            </form>
        </div>
    </div>

    <div id="admin-area" class="p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-2xl font-black text-[#39ff14] italic uppercase">Painel de Controlo</h2>
                <button onclick="hideAdmin()" class="bg-white/10 px-4 py-2 rounded-lg text-xs">Voltar ao Site</button>
            </div>

            <div class="flex gap-6 mb-8 border-b border-white/10 overflow-x-auto">
                <button onclick="switchTab('entregas')" id="tab-entregas" class="pb-3 text-xs font-black uppercase tab-active">Pedidos</button>
                <button onclick="switchTab('dados')" id="tab-dados" class="pb-3 text-xs font-black uppercase text-gray-500">Gráficos</button>
                <button onclick="switchTab('ajustes')" id="tab-ajustes" class="pb-3 text-xs font-black uppercase text-gray-500">Configurações</button>
                <button onclick="switchTab('identidade')" id="tab-identidade" class="pb-3 text-xs font-black uppercase text-gray-500">Identidade</button>
            </div>

            <div id="content-entregas" class="tab-content active">
                <div class="bg-white rounded-3xl overflow-hidden overflow-x-auto">
                    <table class="w-full text-left text-black text-xs">
                        <thead class="bg-gray-100 font-bold uppercase text-gray-400">
                            <tr><th class="p-4">Cliente</th><th class="p-4">Local</th><th class="p-4">Estado</th><th class="p-4">Ações</th></tr>
                        </thead>
                        <tbody id="adminTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="content-dados" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-card-admin">
                        <span class="text-gray-500 text-[10px] font-bold">FATURAMENTO</span>
                        <p class="text-3xl font-black text-blue-400" id="faturamentoTotal">0 MT</p>
                    </div>
                    <div class="bg-card-admin">
                        <span class="text-gray-500 text-[10px] font-bold">CONVERSÃO</span>
                        <p class="text-3xl font-black" id="totalLeads">0 Pedidos</p>
                    </div>
                </div>
                <div class="bg-card-admin h-80">
                    <canvas id="vendasChart"></canvas>
                </div>
            </div>

            <div id="content-ajustes" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-card-admin space-y-4">
                        <h3 class="text-xs font-bold text-blue-400 uppercase">Gestão de Inventário</h3>
                        <div>
                            <label class="text-[10px] text-gray-400 uppercase">Stock Cliente (O que o site mostra)</label>
                            <input type="number" id="admStockMarketing" class="w-full bg-black/50 p-3 rounded-xl border border-white/10 mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 uppercase">Stock Real (Seu armazém interno)</label>
                            <input type="number" id="admStockReal" class="w-full bg-black/50 p-3 rounded-xl border border-white/10 mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 uppercase">Preço Unitário (MT)</label>
                            <input type="number" id="admPreco" class="w-full bg-black/50 p-3 rounded-xl border border-white/10 mt-1">
                        </div>
                        <button onclick="salvarTudo()" class="w-full bg-[#39ff14] text-black font-black py-4 rounded-xl uppercase text-xs">Atualizar Loja</button>
                    </div>
                    <div class="bg-card-admin space-y-4">
                        <h3 class="text-xs font-bold text-blue-400 uppercase">Notificações Automáticas</h3>
                        <div>
                            <label class="text-[10px] text-gray-400 uppercase">Token do Bot Telegram</label>
                            <input type="text" id="telBot" class="w-full bg-black/50 p-3 rounded-xl border border-white/10 mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 uppercase">ID do Chat Admin</label>
                            <input type="text" id="telChat" class="w-full bg-black/50 p-3 rounded-xl border border-white/10 mt-1">
                        </div>
                        <button onclick="salvarTelegram()" class="w-full bg-blue-600 text-white font-black py-4 rounded-xl uppercase text-xs">Guardar Bot</button>
                    </div>
                </div>
            </div>

            <div id="content-identidade" class="tab-content">
                <div class="bg-card-admin max-w-md">
                    <h3 class="text-xs font-bold text-blue-400 uppercase mb-4">Nome do Site</h3>
                    <input type="text" id="admSiteName" placeholder="Ex: VIGOR FERROZ MASTER" class="w-full bg-black/50 p-4 rounded-xl border border-white/10 mb-4">
                    <input type="text" id="admImgUrl" placeholder="Link da Foto do Produto" class="w-full bg-black/50 p-4 rounded-xl border border-white/10 mb-4">
                    <button onclick="salvarIdentidade()" class="w-full bg-purple-600 text-white font-black py-4 rounded-xl uppercase text-xs">Mudar Nome e Foto</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBBNopVEwgMdmnZDELAdSIAoLOW4tLEyZ8",
            databaseURL: "https://vigorferroz-default-rtdb.firebaseio.com",
            projectId: "vigorferroz",
            appId: "1:263350995456:web:a1b3e080a6bf0de9dc26e5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Gerar Horas
        const hSel = document.getElementById('horario');
        for(let i=9; i<=19; i++) hSel.innerHTML += `<option>${i < 10 ? '0'+i : i}:00</option>`;

        // Prova Social
        const nomesP = ["Mateus", "Artur", "Mussá", "Carlos", "Delfim", "Sérgio", "Filipe", "Ricardo"];
        setInterval(() => {
            const agora = new Date();
            const h = agora.getHours().toString().padStart(2, '0');
            const m = agora.getMinutes().toString().padStart(2, '0');
            document.getElementById('social-name').innerText = nomesP[Math.floor(Math.random()*nomesP.length)];
            document.getElementById('social-time').innerText = `${h}:${m}`;
            const el = document.getElementById('social-notify');
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 5000);
        }, 15000);

        // Admin Funções
        function showAdmin() { if(prompt("Código:")==="Lasanha"){ document.getElementById('client-site').style.display='none'; document.getElementById('admin-area').style.display='block'; carregarPedidos(); } }
        function hideAdmin() { document.getElementById('client-site').style.display='block'; document.getElementById('admin-area').style.display='none'; }
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.remove('tab-active', 'text-[#39ff14]'));
            document.getElementById('content-' + tab).classList.add('active');
            document.getElementById('tab-' + tab).classList.add('tab-active');
        }

        // Lógica Firebase
        db.ref('configuracao').on('value', snap => {
            const c = snap.val() || {};
            document.getElementById('site-main-name').innerText = c.nomeSite || "VIGOR FERROZ";
            document.getElementById('site-title-tag').innerText = c.nomeSite || "VIGOR FERROZ";
            document.getElementById('urgenciaStock').innerText = c.stockMarketing || 0;
            document.getElementById('precoExibicao').innerText = (c.preco || 0).toLocaleString() + " MT";
            document.getElementById('fotoProduto').src = c.imagem || "";
            document.getElementById('admSiteName').value = c.nomeSite || "";
            document.getElementById('admStockMarketing').value = c.stockMarketing || 0;
            document.getElementById('admStockReal').value = c.stockReal || 0;
            document.getElementById('admPreco').value = c.preco || 0;
            document.getElementById('admImgUrl').value = c.imagem || "";
        });

        document.getElementById('orderForm').onsubmit = async function(e) {
            e.preventDefault();
            const p = {
                nome: document.getElementById('nome').value,
                contacto: document.getElementById('contacto').value,
                local: `${document.getElementById('bairro').value}, ${document.getElementById('provincia').value}`,
                horario: document.getElementById('horario').value,
                status: "Pendente",
                diaSemana: new Date().getDay(),
                timestamp: 0 - Date.now()
            };
            await db.ref('pedidos').push(p);
            alert("REGISTADO COM SUCESSO!");
            this.reset();
        };

        let windowChart = null;
        function carregarPedidos() {
            db.ref('pedidos').orderByChild('timestamp').on('value', snap => {
                const table = document.getElementById('adminTable');
                table.innerHTML = "";
                let fat = 0, total = 0;
                let stats = { pendente:[0,0,0,0,0,0,0], entregue:[0,0,0,0,0,0,0], confirmado:[0,0,0,0,0,0,0], cancelado:[0,0,0,0,0,0,0] };
                const preco = parseInt(document.getElementById('admPreco').value) || 0;

                snap.forEach(child => {
                    const p = child.val();
                    total++;
                    const st = p.status.toLowerCase();
                    if(st === 'entregue') fat += preco;
                    if(stats[st]) stats[st][p.diaSemana]++;

                    const dados = `PEDIDO:\n${p.nome}\n${p.contacto}\n${p.local}\n${p.horario}`;

                    table.innerHTML += `
                        <tr class="border-b">
                            <td class="p-4"><b>${p.nome}</b><br>${p.contacto}</td>
                            <td class="p-4">${p.local}<br><b>${p.horario}</b></td>
                            <td class="p-4"><button onclick="mudarStatus('${child.key}','${p.status}')" class="status-${st} w-full py-2 rounded-lg font-bold uppercase text-[9px]">${p.status}</button></td>
                            <td class="p-4 flex gap-2">
                                <button onclick="navigator.clipboard.writeText(\`${dados}\`); alert('Copiado!')" class="bg-blue-100 text-blue-600 p-2 rounded-lg"><i class="fas fa-copy"></i></button>
                                <button onclick="apagar('${child.key}')" class="bg-gray-100 text-gray-400 p-2 rounded-lg"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                });
                document.getElementById('totalLeads').innerText = total + " Pedidos";
                document.getElementById('faturamentoTotal').innerText = fat.toLocaleString() + " MT";
                renderGrafico(stats);
            });
        }

        async function mudarStatus(id, s) {
            let ord = ["Pendente", "Confirmado", "Entregue", "Cancelado"];
            await db.ref('pedidos/'+id).update({status: ord[(ord.indexOf(s) + 1) % 4]});
        }
        async function apagar(id) { if(confirm("Apagar?")) await db.ref('pedidos/'+id).remove(); }

        function renderGrafico(stats) {
            const ctx = document.getElementById('vendasChart').getContext('2d');
            if(windowChart) windowChart.destroy();
            windowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
                    datasets: [
                        { label: 'Entregues', data: stats.entregue, borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4 },
                        { label: 'Pendentes', data: stats.pendente, borderColor: '#facc15', borderDash: [5, 5], tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false } } }
            });
        }

        async function salvarTudo() {
            await db.ref('configuracao').update({
                stockMarketing: parseInt(document.getElementById('admStockMarketing').value),
                stockReal: parseInt(document.getElementById('admStockReal').value),
                preco: parseInt(document.getElementById('admPreco').value)
            });
            alert("Ajustes Salvos!");
        }

        async function salvarIdentidade() {
            await db.ref('configuracao').update({
                nomeSite: document.getElementById('admSiteName').value,
                imagem: document.getElementById('admImgUrl').value
            });
            alert("Identidade Atualizada!");
        }

        async function salvarTelegram() {
            await db.ref('telegram').set({ bot: document.getElementById('telBot').value, chat: document.getElementById('telChat').value });
            alert("Bot Configurado!");
        }
    </script>
</body>
</html>

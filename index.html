<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">VIGOR FERROZ | Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #fdfdfd; font-family: 'Inter', sans-serif; }
        .status-pendente { background: #f1c40f !important; color: #000; }
        .status-confirmado { background: #2ecc71 !important; color: #fff; }
        .status-entregue { background: #3498db !important; color: #fff; }
        .status-cancelado { background: #e74c3c !important; color: #fff; }
        
        #social-notify {
            position: fixed; bottom: 20px; left: 15px; right: 15px; 
            background: #000; color: #fff; padding: 15px; border-radius: 15px;
            border-left: 5px solid #2ecc71; transform: translateY(200%);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 9999;
        }
        #social-notify.active { transform: translateY(0); }
        
        .client-input { width: 100%; padding: 18px; margin-bottom: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; }
        #admin-area { display: none; background: #0f172a; min-height: 100vh; color: #fff; z-index: 10000; position: absolute; top: 0; width: 100%; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .active-tab-btn { border-bottom: 3px solid #39ff14; color: #39ff14; }
        .benefit-item { display: flex; align-items: center; gap: 8px; font-weight: 600; color: #166534; font-size: 14px; }
    </style>
</head>
<body>

    <div id="social-notify">
        <div class="flex items-center gap-3">
            <i class="fas fa-shopping-cart text-green-400"></i>
            <div>
                <b id="s-name">Ant√≥nio</b>
                <span class="block text-[10px] opacity-70">Encomendou agora √†s <span id="s-time">--:--</span></span>
            </div>
        </div>
    </div>

    <div id="client-site">
        <div class="bg-red-600 text-white text-center py-2 text-[11px] font-bold sticky top-0 z-50">
            <span onclick="openAdmin()" style="cursor:pointer">‚ö†Ô∏è</span> 
            RESTAM <span id="viewStock">--</span> UNIDADES EM STOCK
        </div>

        <div class="max-w-[480px] mx-auto p-4">
            <h1 id="site-h1" class="text-center font-black text-3xl italic text-green-700 mb-4 uppercase">VIGOR FERROZ</h1>
            
            <img id="viewImg" src="" class="w-full rounded-3xl shadow-lg border-4 border-white mb-4">

            <div class="bg-orange-500 text-white p-3 rounded-2xl text-center font-black text-sm shadow-lg mb-6 animate-bounce">
                üöÄ PAGUE APENAS NO ACTO DA ENTREGA!
            </div>

            <div class="bg-green-50 p-5 rounded-3xl border border-green-100 mb-6 space-y-3" id="viewBenefits">
                </div>

            <form id="orderForm" autocomplete="off">
                <input type="text" id="nome" placeholder="Seu Nome" class="client-input" required>
                <input type="tel" id="contacto" placeholder="Telem√≥vel" class="client-input" required pattern="[0-9]*" inputmode="numeric">
                <select id="provincia" class="client-input" required>
                    <option value="" disabled selected>Prov√≠ncia</option>
                    <option>Maputo</option><option>Matola</option><option>Beira</option><option>Nampula</option>
                </select>
                <input type="text" id="bairro" placeholder="Bairro / Rua" class="client-input" required>
                <select id="horario" class="client-input" required></select>

                <button type="submit" id="btnSubmit" class="w-full bg-green-600 text-white p-6 rounded-2xl font-black shadow-xl active:scale-95 transition">
                    <span class="text-2xl" id="viewPreco">--- MT</span>
                    <small class="block opacity-70 uppercase text-[10px] mt-1">Confirmar Encomenda Agora</small>
                </button>
            </form>
        </div>
    </div>

    <div id="admin-area" class="p-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="font-black text-green-400">ADMIN MASTER</h2>
            <button onclick="closeAdmin()" class="text-xs bg-white/10 px-3 py-1 rounded">Sair</button>
        </div>

        <div class="flex gap-4 border-b border-white/10 mb-6 overflow-x-auto pb-2">
            <button onclick="nav('pedidos')" id="btn-pedidos" class="text-[10px] font-bold uppercase active-tab-btn">Pedidos</button>
            <button onclick="nav('relatorios')" id="btn-relatorios" class="text-[10px] font-bold uppercase text-gray-500">Relat√≥rios</button>
            <button onclick="nav('loja')" id="btn-loja" class="text-[10px] font-bold uppercase text-gray-500">Loja & Stock</button>
            <button onclick="nav('site')" id="btn-site" class="text-[10px] font-bold uppercase text-gray-500">Site</button>
        </div>

        <div id="sec-pedidos" class="tab-content active">
            <div id="leadsList" class="space-y-3"></div>
        </div>

        <div id="sec-relatorios" class="tab-content">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-slate-800 p-4 rounded-2xl">
                    <small class="opacity-50 text-[10px]">TOTAL VENDAS</small>
                    <p class="text-xl font-black text-green-400" id="statFatura">0 MT</p>
                </div>
                <div class="bg-slate-800 p-4 rounded-2xl">
                    <small class="opacity-50 text-[10px]">LEADS</small>
                    <p class="text-xl font-black" id="statLeads">0</p>
                </div>
            </div>
            <div class="bg-slate-800 p-4 rounded-3xl h-72">
                <canvas id="chart3D"></canvas>
            </div>
        </div>

        <div id="sec-loja" class="tab-content">
            <div class="bg-slate-800 p-6 rounded-3xl space-y-4">
                <div>
                    <label class="text-[10px] opacity-50 uppercase">Stock Marketing (Vis√≠vel)</label>
                    <input type="number" id="inStockM" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1">
                </div>
                <div>
                    <label class="text-[10px] opacity-50 uppercase">Stock Real (Armaz√©m)</label>
                    <input type="number" id="inStockR" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1">
                </div>
                <div>
                    <label class="text-[10px] opacity-50 uppercase">Pre√ßo Unit√°rio (MT)</label>
                    <input type="number" id="inPreco" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1">
                </div>
                <button onclick="saveStore()" class="w-full bg-green-500 text-black font-black py-4 rounded-xl">SALVAR STOCK</button>
            </div>
        </div>

        <div id="sec-site" class="tab-content">
            <div class="bg-slate-800 p-6 rounded-3xl space-y-4">
                <div>
                    <label class="text-[10px] opacity-50 uppercase">T√≠tulo do Site (H1)</label>
                    <input type="text" id="inH1" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1">
                </div>
                <div>
                    <label class="text-[10px] opacity-50 uppercase">URL Imagem Produto</label>
                    <input type="text" id="inImg" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1">
                </div>
                <div>
                    <label class="text-[10px] opacity-50 uppercase">Benef√≠cios (Um por linha)</label>
                    <textarea id="inBenefits" rows="5" class="w-full bg-black/30 p-3 rounded-xl border border-white/10 mt-1 text-xs"></textarea>
                </div>
                <button onclick="saveSite()" class="w-full bg-purple-600 text-white font-black py-4 rounded-xl">ATUALIZAR SITE</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGS TELEGRAM
        const T_TOKEN = "8239737889:AAGkxi-iTBmRYBlib5yqLKrjsEQcitLYwcc";
        const T_ID = "7277552972";

        const firebaseConfig = {
            apiKey: "AIzaSyBBNopVEwgMdmnZDELAdSIAoLOW4tLEyZ8",
            databaseURL: "https://vigorferroz-default-rtdb.firebaseio.com",
            projectId: "vigorferroz",
            appId: "1:263350995456:web:a1b3e080a6bf0de9dc26e5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Gerar horas
        const hs = document.getElementById('horario');
        for(let i=9; i<=19; i++) hs.innerHTML += `<option>${i}:00</option>`;

        // Navega√ß√£o Admin
        function openAdmin() { if(prompt("Acesso:")==="Lasanha"){ document.getElementById('client-site').style.display='none'; document.getElementById('admin-area').style.display='block'; loadData(); }}
        function closeAdmin() { document.getElementById('client-site').style.display='block'; document.getElementById('admin-area').style.display='none'; }
        function nav(sec) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('[id^="btn-"]').forEach(b => b.classList.remove('active-tab-btn', 'text-green-400'));
            document.getElementById('sec-'+sec).classList.add('active');
            document.getElementById('btn-'+sec).classList.add('active-tab-btn');
        }

        // Sincroniza√ß√£o em tempo real
        db.ref('config').on('value', snap => {
            const c = snap.val() || {
                benefits: "‚úÖElimina a impot√™ncia sexual\n‚úÖEre√ß√µes mais firmes e resistentes\n‚úÖAcabe com a eaculacao precoce e domine\n‚úÖaumenta o tamanho DO PENIS\n‚úÖ100% natural e sem efeitos colaterais"
            };
            document.getElementById('site-h1').innerText = c.h1 || "VIGOR FERROZ";
            document.getElementById('viewStock').innerText = c.stockM || 0;
            document.getElementById('viewPreco').innerText = (c.preco || 0).toLocaleString() + " MT";
            document.getElementById('viewImg').src = c.img || "";
            
            // Renderizar Benef√≠cios
            const bDiv = document.getElementById('viewBenefits');
            bDiv.innerHTML = "";
            c.benefits.split('\n').forEach(b => {
                if(b.trim()) bDiv.innerHTML += `<div class="benefit-item">${b}</div>`;
            });

            // Preencher campos Admin
            document.getElementById('inH1').value = c.h1 || "";
            document.getElementById('inStockM').value = c.stockM || 0;
            document.getElementById('inStockR').value = c.stockR || 0;
            document.getElementById('inPreco').value = c.preco || 0;
            document.getElementById('inImg').value = c.img || "";
            document.getElementById('inBenefits').value = c.benefits || "";
        });

        // Pedido
        document.getElementById('orderForm').onsubmit = async function(e) {
            e.preventDefault();
            const p = {
                nome: document.getElementById('nome').value,
                tel: document.getElementById('contacto').value,
                local: `${document.getElementById('bairro').value}, ${document.getElementById('provincia').value}`,
                hora: document.getElementById('horario').value,
                status: "Pendente",
                dia: new Date().getDay(),
                ts: 0 - Date.now()
            };
            await db.ref('leads').push(p);
            fetch(`https://api.telegram.org/bot${T_TOKEN}/sendMessage?chat_id=${T_ID}&text=${encodeURIComponent("üöÄ NOVO PEDIDO: "+p.nome+" ("+p.tel+")\nüìç "+p.local)}`);
            alert("PEDIDO RECEBIDO!");
            this.reset();
        };

        let myChart = null;
        function loadData() {
            db.ref('leads').orderByChild('ts').on('value', snap => {
                const list = document.getElementById('leadsList');
                list.innerHTML = "";
                let fat = 0, total = 0;
                let st = { Pendente:0, Confirmado:0, Entregue:0, Cancelado:0 };
                const pr = parseInt(document.getElementById('inPreco').value);

                snap.forEach(child => {
                    const l = child.val();
                    total++;
                    st[l.status]++;
                    if(l.status === 'Entregue') fat += pr;

                    list.innerHTML += `
                    <div class="bg-slate-800 p-4 rounded-2xl border border-white/5">
                        <div class="flex justify-between items-start mb-2">
                            <b>${l.nome}</b>
                            <button onclick="mudarStatus('${child.key}','${l.status}')" class="status-${l.status.toLowerCase()} px-3 py-1 rounded-lg text-[9px] font-black uppercase">${l.status}</button>
                        </div>
                        <p class="text-[10px] opacity-60">${l.tel} | ${l.local} | ${l.hora}</p>
                    </div>`;
                });
                document.getElementById('statLeads').innerText = total;
                document.getElementById('statFatura').innerText = fat.toLocaleString() + " MT";
                updateChart(st);
            });
        }

        async function mudarStatus(id, s) {
            const n = ["Pendente", "Confirmado", "Entregue", "Cancelado"];
            await db.ref('leads/'+id).update({status: n[(n.indexOf(s)+1)%4]});
        }

        function updateChart(s) {
            const ctx = document.getElementById('chart3D');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Pendente', 'Confirmado', 'Entregue', 'Cancelado'],
                    datasets: [{
                        data: [s.Pendente, s.Confirmado, s.Entregue, s.Cancelado],
                        backgroundColor: ['#f1c40f', '#2ecc71', '#3498db', '#e74c3c'],
                        borderRadius: 10
                    }]
                },
                options: { maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{display:false},x:{ticks:{color:'#fff',font:{size:8}}}} }
            });
        }

        async function saveStore() {
            await db.ref('config').update({
                stockM: parseInt(document.getElementById('inStockM').value),
                stockR: parseInt(document.getElementById('inStockR').value),
                preco: parseInt(document.getElementById('inPreco').value)
            });
            alert("Stock salvo!");
        }

        async function saveSite() {
            await db.ref('config').update({
                h1: document.getElementById('inH1').value,
                img: document.getElementById('inImg').value,
                benefits: document.getElementById('inBenefits').value
            });
            alert("Site atualizado!");
        }

        // Prova Social Random
        const nms = ["Mateus", "Artur", "Muss√°", "Carlos", "Delfim", "S√©rgio", "Filipe"];
        setInterval(() => {
            if(document.getElementById('client-site').style.display !== 'none') {
                const now = new Date();
                document.getElementById('s-name').innerText = nms[Math.floor(Math.random()*nms.length)];
                document.getElementById('s-time').innerText = now.getHours()+":"+now.getMinutes();
                document.getElementById('social-notify').classList.add('active');
                setTimeout(() => document.getElementById('social-notify').classList.remove('active'), 5000);
            }
        }, 15000);
    </script>
</body>
</html>
